# Коридор — анализ автоматизаций и замена трёх ламп на люстру

**Смысл:** `light.koridor_liustra` — это хелпер (группа) в HA, собранная из трёх ламп `light.rgbcw_lightbulb_koridor_1`, `_2`, `_3`. Где авто обращаются к трём лампам отдельно, их лучше заменить на люстру: проще поддержка и единая точка управления.

**Статус:** Замены по пунктам 3, 4, 5 в HA уже сделаны (в авто везде используется `light.koridor_liustra`). Ниже — описание и рекомендации на момент анализа; актуальное состояние — в HA.

---

## Сводная таблица: кто что использует

| Автоматизация | ID | Лампы/люстра | Статус |
|---------------|-----|--------------|--------|
| Свет в коридоре, датчик движения | 1740729493665 | `device_id` (одна лампа) | Не менять — намеренно одна лампа |
| Свет в коридоре, выключатель | 1745511757537 | `light.koridor_liustra` | Ручное управление |
| Выключатель в коридоре — отключать все лампочки | 1749584062547 | `light.koridor_liustra` | ✅ В HA сделано |
| Свет при открытии двери | 1760376439440 | `light.koridor_liustra` | ✅ В HA сделано, disabled почищены |
| Коридор, свет по датчику присутствия | 1760411090519 | `light.koridor_liustra` | ✅ В HA сделано |
| Включать всё дома при открытии двери | 1741931745302 | Розетки/подсветка, не свет коридора | — |

---
<br>

## 1. Свет в коридоре, датчик движения

**id:** `1740729493665`

**Что делает:** Датчик occupancy + освещённость < 50 → включает свет (1% яркость), ждёт 1 мин без движения → выключает.

**Сейчас:** `device_id` — одна лампа из трёх.

**Рекомендация:** Не менять. В темноте включается именно одна лампа (мягкая подсветка ночью), а не вся люстра — так и задумано.

---
<br>

## 2. Свет в коридоре, выключатель

**id:** `1745511757537`

**Что делает:** Ручное управление без датчиков — одиночное нажатие выключателя:
- Если лампы 1 on, 2 и 3 off → гасит только первую.
- Если люстра off → включает на 45 мин, выкл датчик движения, потом выкл, снова вкл датчик.
- Если люстра on → выключает и включает датчик движения.

**Сейчас:** conditions — `device_id` для каждой лампы; actions — `light.koridor_liustra`.

**Рекомендация:** Не трогать. Всё нормально — ручное управление, логика корректная.

---
<br>

## 3. Выключатель в коридоре — отключать все лампочки

**id:** `1749584062547`

**Что делает:** Удержание выключателя → выключить все три лампы.

**В HA:** уже используется `target: entity_id: light.koridor_liustra`. Раньше было по `device_id` трёх ламп — заменено.

*Текущая конфигурация в HA (для справки):*

```yaml
- id: '1749584062547'
  alias: Выключатель в коридоре - отключать все лампочки
  description: ''
  triggers:
  - domain: mqtt
    device_id: 235aa890c6232fc54530eb125a411c52
    type: action
    subtype: hold
    trigger: device
  conditions: []
  actions:
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.koridor_liustra
  mode: single
```

---
<br>

## 4. Свет при открытии двери

**id:** `1760376439440`

**Что делает:** Дверь открылась → включает `svet_i_datchik_dvizheniia`, включает свет, ждёт 30 сек без присутствия → выключает свет.

**В HA:** везде `light.koridor_liustra`, отключённые (disabled) шаги с device_id удалены. Цепочка: turn_on авто датчика → light.turn_on люстра → wait_for_trigger 30 сек нет присутствия → light.turn_off люстра.

*Текущая конфигурация в HA (для справки):*

```yaml
- id: '1760376439440'
  alias: Свет при открытии двери
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.koridor_datchik_otkrytiia_dver_contact
    from: 'off'
    to: 'on'
  conditions: []
  actions:
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.svet_i_datchik_dvizheniia
  - action: light.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: light.koridor_liustra
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.koridor_datchik_prisutstviia_presence
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 30
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.koridor_liustra
  mode: single
```

---
<br>

## 5. Коридор, свет по датчику присутствия

**id:** `1760411090519`

**Что делает:** 05:00–22:00, приход присутствия → вкл люстру (100%, 5200K), выкл авто «датчик движения», ждёт 30 сек без присутствия → выкл люстру, вкл авто «датчик движения».

**В HA:** уже используется `entity_id: light.koridor_liustra` для turn_on и turn_off (раньше были три лампы по отдельности — заменено).

*Текущая конфигурация в HA (для справки):*

```yaml
- id: '1760411090519'
  alias: Коридор, свет по датчику присутствия
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.koridor_datchik_prisutstviia_presence
    from:
    - 'off'
    to:
    - 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
  conditions:
  - condition: time
    before: '22:00:00'
    after: 05:00:00
  actions:
  - action: light.turn_on
    metadata: {}
    data:
      brightness_pct: 100
      color_temp_kelvin: 5200
    target:
      entity_id: light.koridor_liustra
  - action: automation.turn_off
    metadata: {}
    data:
      stop_actions: true
    target:
      entity_id: automation.svet_v_koridore_datchik_dvizheniia
  - wait_for_trigger:
    - trigger: state
      entity_id:
      - binary_sensor.koridor_datchik_prisutstviia_presence
      from: 'on'
      to: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 30
  - action: light.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: light.koridor_liustra
  - action: automation.turn_on
    metadata: {}
    data: {}
    target:
      entity_id: automation.svet_v_koridore_datchik_dvizheniia
  mode: single
```

---
<br>

## 6. Включать всё дома при открытии двери

**id:** `1741931745302`

**Что делает:** Другая дверь (opened) → включает розетки/подсветку. Свет в коридоре не трогает.

**Рекомендация:** Не менять.

---
<br>

## Чек-лист замен

| # | Действие |
|---|----------|
| 1 | **Выключатель — отключать все лампочки:** device_id трёх ламп → `entity_id: light.koridor_liustra` |
| 2 | **Коридор, свет по датчику присутствия:** entity_id трёх ламп → `entity_id: light.koridor_liustra` |
| 3 | **Свет в коридоре, датчик движения:** оставить как есть — одна лампа намеренно |
| 4 | **Свет при открытии двери:** удалить disabled-шаги с device_id (по желанию) |

---
<br>

## Упрощённые фрагменты YAML

### Выключатель — отключать все лампочки (после замены)

```yaml
  actions:
  - action: light.turn_off
    target:
      entity_id: light.koridor_liustra
```

### Коридор, свет по датчику присутствия (после замены)

```yaml
  - action: light.turn_on
    data:
      brightness_pct: 100
      color_temp_kelvin: 5200
    target:
      entity_id: light.koridor_liustra
  # ... wait_for_trigger ...
  - action: light.turn_off
    target:
      entity_id: light.koridor_liustra
```

---

*Файл сгенерирован по automations.yaml. Перед правками в HA — сделать бэкап и перезагрузить automations после изменений.*
