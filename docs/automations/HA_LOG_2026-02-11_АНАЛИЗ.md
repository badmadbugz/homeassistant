## Анализ лога Home Assistant от 2026-02-11

Источник: `home-assistant_2026-02-11T08-55-11.192Z.log`

---

## 1. Кастомные интеграции (много WARNING от `homeassistant.loader`)

**Сообщения**

- `We found a custom integration yandex_smart_home ...`
- `moscow_transport`, `person_location`, `isp_cabinet`, `scheduler`, `tuya_local`,
  `pandora_cas`, `calendar_event`, `ha_keenetic`, `proxmoxve`,
  `yandex_music_browser`, `ble_monitor`, `keenetic_api`, `hacs`, `tapo`

**Суть**

- Это стандартные предупреждения: эти интеграции *не из официального репозитория*.
- Они **не блокируют загрузку HA**, только сигнализируют, что код не проверялся командой HA.

**Что делать**

- Если всё работает и стабильность устраивает — **можно ничего не делать**.
- Если хочешь «почище» лог:
  - Либо удалить/отключить конкретные кастомные интеграции, которые не используешь.
  - Либо уменьшить болтовню через `logger:` (понизить уровень для `homeassistant.loader`).

---

## 2. `isp_cabinet` — заблокирован из-за отсутствия `version` в `manifest.json`

**Сообщение**

- `ERROR [homeassistant.loader] The custom integration 'isp_cabinet' does not have a version key in the manifest file and was blocked from loading.`

**Суть**

- В `custom_components/isp_cabinet/manifest.json` **нет ключа `"version"`**.
- По новым правилам HA такие кастомные интеграции **не загружаются**.

**Как исправить**

- Открыть `custom_components/isp_cabinet/manifest.json` и добавить, например:

  ```json
  "version": "0.1.0"
  ```

  (любое строковое значение; важно само наличие ключа).

- Перезапустить HA Core.

**Альтернатива**

- Если `isp_cabinet` больше не нужен:
  - Удалить папку интеграции из `custom_components`,
  - Убрать все ссылки на него из `configuration.yaml` → ошибка пропадёт.

---

## 3. ESPHome `ble-gateway` (192.168.1.78:6053)

**Сообщение**

- `Can't connect to ESPHome API for ble-gateway @ 192.168.1.78:6053 ... Connect call failed ('192.168.1.78', 6053)`

**Суть**

- HA не может подключиться к ESPHome‑устройству `ble-gateway`.
- Причины: устройство выключено/офлайн, IP изменился, порт не слушается, сетевые проблемы.

**Что делать**

- Если устройство **нужно**:
  - Проверить, что 192.168.1.78 пингуется.
  - Убедиться, что ESPHome‑нод запущен и слушает порт 6053.
  - Закрепить статический IP/резервацию DHCP, чтобы адрес не менялся.

- Если `ble-gateway` уже не используется:
  - Удалить/отключить его в интеграции ESPHome / в UI Home Assistant.

---

## 4. IMAP / `aioimaplib` — «Task was destroyed but it is pending»

**Сообщения**

- Несколько строк вида:
  - `ERROR (Recorder) [homeassistant] Error doing job: Task was destroyed but it is pending! (task: ... IMAP4.idle() ... )`

**Суть**

- Это фоновые задачи IMAP‑подписок (`aioimaplib.IMAP4.idle()`), которые не успевают корректно завершиться при остановке/рестарте или обрыве соединения.
- Классический «шум» от почтовых интеграций, не обязательно критический для работы HA.

**Что делать**

- Если почтовая интеграция действительно **нужна**:
  - Убедиться, что настройки IMAP (сервер, порт, SSL, папки) корректны.
  - Держать HA и саму интеграцию обновлёнными.

- Если почта не используется или уже не нужна:
  - Отключить/удалить интеграцию IMAP → эти ошибки исчезнут.

- Если всё работает, но ошибки мешают:
  - В `logger:` можно понизить уровень логирования для соответствующей интеграции/модуля (`aioimaplib`).

---

## 5. Автоматизация «Индикатор отложенной стирки»

**Сообщение**

- `WARNING [automation.indikator_otlozhennoi_stirki] Индикатор отложенной стирки: Already running`

**Суть**

- Автоматизация уже выполняется в момент, когда приходит следующий триггер.
- Скорее всего, у неё стоит режим по умолчанию `mode: single`, а внутри есть длительные действия (`delay`, ожидание и т.п.).

**Как исправить**

- В YAML этой автоматизации:
  - Если при новом событии нужно **перезапускать** сценарий:

    ```yaml
    mode: restart
    ```

  - Если срабатывания нужно **ставить в очередь**:

    ```yaml
    mode: queued
    max: 10  # пример разумного лимита
    ```

Это уберёт `Already running` и сделает поведение предсказуемым.

---

## 6. Автоматизация «Коридор, свет по датчику присутствия»

**Сообщения**

- Множество:
  - `WARNING [automation.svet_i_datchik_dvizheniia] Коридор, свет по датчику присутствия: Already running`

**Суть**

- Та же проблема: автоматизация дольше выполняется, чем интервал между новыми событиями от датчика.
- При `mode: single` новые срабатывания «натыкаются» на уже выполняющийся инстанс → предупреждение `Already running`.

**Как исправить**

- В YAML этой авто:

  - Если логика должна **перезапускаться** при каждом новом движении:

    ```yaml
    mode: restart
    ```

  - Если нужно ставить срабатывания в очередь:

    ```yaml
    mode: queued
    max: 5  # лимит на одновременную очередь
    ```

- Дополнительно:
  - Пересмотреть `delay` и логику выключения, чтобы не было лишне долгих висящих действий.
  - Использовать `for:` в триггерах (`for: 3s/5s`), чтобы сгладить «дребезг» датчика.

---

## 7. `tuya_local` — ошибки обновления состояния

**Сообщения**

- `ERROR [custom_components.tuya_local.device] Failed to update device state.` (повторяется)

**Суть**

- Кастомный компонент `tuya_local` не может получить состояние одного или нескольких устройств Tuya.
- Возможные причины:
  - устройство офлайн / не в сети;
  - изменился локальный ключ / схема DP после обновления прошивки;
  - проблемы с доступом к IP/порту устройства.

**Как разрулить**

- Обновить интеграцию `tuya_local` через HACS до последней версии.
- Определить, **какие устройства** падают:
  - Временно включить более подробный лог для `custom_components.tuya_local`.
  - По логам увидеть конкретные `entity_id`/устройства.
- По проблемным устройствам:
  - Проверить, что они в сети и пингуются.
  - Перепроверить конфиг (ID, local_key, DP‑id).
- Если какое‑то устройство больше не используешь:
  - Удалить его из конфигурации `tuya_local` → ошибки по нему уйдут.

---

## 8. UPnP / `async_upnp_client` — проблемы с (пере)подпиской

**Сообщения**

- `WARNING [async_upnp_client.profiles.profile] Failed (re-)subscribing to: uuid:..., reason: UpnpConnectionError(...)`

**Суть**

- UPnP/DLNA‑устройства (телевизоры, медиаплееры и т.п.) периодически отваливаются:
  - выключены,
  - сменили IP,
  - разорвали соединение.
- HA не может обновить подписку на события этих устройств.

**Что делать**

- Если интеграция с этими устройствами не нужна:
  - Отключить/удалить соответствующую интеграцию → предупреждения пропадёт.

- Если нужна и всё в целом работает:
  - Обычно это просто «жёлтый шум», на работу HA серьёзно не влияет.
  - Можно понизить уровень логирования для `async_upnp_client` через `logger:`.

---

## 9. Приоритеты по «починке» лога

1. **`isp_cabinet`**
   - Либо добавить `"version"` в `manifest.json`, либо удалить интеграцию, если не нужна.

2. **Режимы автоматизаций**
   - `indikator_otlozhennoi_stirki` и `svet_i_datchik_dvizheniia`:
     - выставить `mode: restart` или `mode: queued` → убрать `Already running`.

3. **`tuya_local`**
   - Обновить интеграцию, найти и исправить/отключить проблемные устройства.

4. **ESPHome `ble-gateway`**
   - Проверить, жив ли узел и корректен ли IP; если не нужен — удалить.

5. **UPnP‑предупреждения**
   - При желании отключить/отрегулировать через `logger:` или отключить ненужные интеграции.
